# Frontend design

## Write

### Title, Text, Preview

The user here can input title, text, and get a preview of the post after MarkDown rendering.

### Upload button

The user can upload files here.

The upload progress bar will be shown here.

### Linked files

File uploads linked with the current post.

Each file can have 3 buttons:

* Insert image
* Insert link
* Delete

Insert image appears only if the image has a .png .jpg .jpeg .gif extension.

# Frontend hash format

`hash.service.js` listens and manages changes to the URL's hash component. Allows the user to follow direct links to different parts of the site

Encoding of URI components:

JSON string of [target, data...]

The target encodes the path that needs to be activated, for example `posts`.

`data` is arbitrary data that will be passed to the controller.

The controller will receive the full array, including the target part.

Targets that can handle `hashchange` events will register on this service using the `register()` method.

The registered handle has the shape `function(hash_component)` where `hash_component` is the type of js array defined above.

# Global configuration

There are 2 main configuration files that are generated by `setup.js`:

* `local/config.json` used by the backend
* `client/globals.js` loaded by the client. It contains a `jpress_globals` variable that can be read by the frontend javascript.

## local/config.json

Contains keys:

* privkey - SSL private key location
* cert - SSL certification location
* user - blog username
* passhash - hashed password
* db - directory where database is stored
* upload_path - directory where uploaded files are stored
* port - ws port

## client/globals.js

Contains global variable `jpress_globals` with keys:

* port - ws port
* title - title of the blog

# Client global variables

The client global variable `BASEURL` stores the base url (starting with a /) to be used to create relative URLs. The BASEURL is dynamically initialized by the server and injected in the HTML file as a script tag.